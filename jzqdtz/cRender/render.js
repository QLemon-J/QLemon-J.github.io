(function(u){function E(){this.curItem=-1;this.loadedImages={};this.processCallback=this.endCallback=this.data=null;this.minProgressVal=0;this.maxProgressVal=100;this.wait=d.proxy(this.wait,this)}function B(a,c,e){this.sounds=a;this.endCallback=c;this.progressCallback=e;this.minProgressVal=this.loadedCount=0;this.maxProgressVal=100}function C(a,c,e,f,d,g){this.name=a+"";this.src=c+"";this.width=e;this.height=f;this.frames=d;this.layers=g;this.object=this.bitmap=null;this.ready=this.width&&this.height;
this.spriteClass=null}function x(a,c,e){this.path="images";this.scale=1;this.items={};this.bitmaps={};this.loaded=!1;this.onloadprogress=this.onload=null;this.spriteClass=p;this.onLoadHandler=d.proxy(this.onLoadHandler,this);this.onLoadProgressHandler=d.proxy(this.onLoadProgressHandler,this);this.init(a,c);this.addAssets(e)}function n(a,c){"undefined"==typeof a&&(a=0);this.x=a;"undefined"==typeof c&&(c=0);this.y=c}function y(a,c,e,f,d){this.center=new n(a,c);this.width=e;this.height=f;this.angle=
d;this.vertices=[];this.AABB=[];this.refreshVertices()}function z(){this.eventsListeners=[]}function s(a,c,e,f,h,g){d.callSuperConstructor(s,this);"object"!=typeof a&&(a=null);if(a){if("undefined"==typeof a[c])throw Error('Trying to tween undefined property "'+c+'"');if(isNaN(a[c]))throw Error("Tweened value can not be "+typeof a[c]);}else if(isNaN(c))throw Error("Tweened value can not be "+typeof c);"function"!=typeof g&&(g=D.linear.easeIn);this.obj=a;this.prop=c;this.onfinish=this.onchange=null;
this.start=e;this.end=f;this.duration=~~h;this.callback=g;this.playing=!1;this._pos=-1;this.eventsListeners=[]}function l(){d.callSuperConstructor(l,this);this.parent=null;this.objectsCounter=0;this.objects=[];this.height=this.width=this.y=this.x=0;this.anchor={x:0,y:0};this.hitArea=null;this.scaleY=this.scaleX=1;this.rotation=this.skewY=this.skewX=0;this.opacity=1;this.fillPattern=this.fillRadialGradient=this.fillLinearGradient=this.fillColor=null}function q(){d.callSuperConstructor(q,this);this.uid=
0;this.shadowColor=this.stage=null;this.zIndex=this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.visible=!0;this.dragged=this.destroy=this.ignoreViewport=this.static=!1;this.dragY=this.dragX=0;this.mouseOn=!1;this.allowDebugDrawing=!0;this.onbox2dsync=this.onremove=this.onadd=this.onrender=this.onenterframe=this.onprerender=this.onmousemove=this.oncontextmenu=this.onclick=this.onmouseup=this.onmousedown=this.onmouseout=this.onmouseover=this.pixelCheck=null}function k(){d.callSuperConstructor(k,
this);this.y=this.x=0;this.color="#000";this.lineWidth=1}function p(a,c,e,f,h){d.callSuperConstructor(p,this);this.width=c;this.height=e;this.offset={left:0,top:0};this.animated=!0;this.animDirection=1;this.currentFrame=0;this.totalFrames=Math.max(1,~~f);1>=this.totalFrames&&(this.animated=!1);this.currentLayer=0;this.totalLayers=Math.max(1,~~h);this.bitmap=a;this.mask=null;this.isMask=!1;this.maskParent=null;this.maskInvert=!1;this.animStep=0;this.animDelay=1;this.changeFrameDelay=p.CHANGE_FRAME_DELAY;
this.changeFrameTime=0;this.onchangeframe=null}function w(a,c,e){d.callSuperConstructor(w,this);this.repeat=e;this.timeout=this.initialTimeout=c;this.onend=a;this.ontick=null;this.paused=!1}function m(a,c,e){d.callSuperConstructor(m,this);this.canvas=null;a&&(this.canvas=document.getElementById(a),this.canvas.ctx=this.canvas.getContext("2d"));this.backgroundCanvas=null;this.needToRebuildBack=!1;this.screenWidth=c;this.screenHeight=e;this.viewport={x:0,y:0};this.buffer=null;try{this.buffer=document.createElement("canvas"),
this.buffer.width=c*d.globalScale,this.buffer.height=e*d.globalScale,this.buffer.ctx=this.buffer.getContext("2d")}catch(f){this.buffer=this.canvas}this.delay=40;this.started=!1;this.lastFPS=this.fps=0;this.ceilSizes=this.pixelMouseMoveEvent=this.pixelMouseDownEvent=this.pixelMouseUpEvent=this.pixelClickEvent=this.showFPS=!1;this.tmFPS=this.tmMain=null;this.allowStaticDebugDrawing=this.allowDebugDrawing=this.clearLock=!1;this.drawBackAlways=d.mobileCheckBrokenAndroid();this.tweens=[];this.timers=[];
this.eventsListeners=[];this.lastTick=0;this.onmousemove=this.oncontextmenu=this.onclick=this.onmouseup=this.onmousedown=this.onposttick=this.onpretick=this.inputController=null;this.canvas&&this.addInputListeners(this.canvas);this.tick=d.proxy(this.tick,this);this.clearFPS=d.proxy(this.clearFPS,this);this.stage=this;this.drawScene=this.render}"undefined"==typeof window.console&&(window.console={log:function(){}});var d={};d.touchScreen="ontouchstart"in window;d.globalScale=1;d.globalPixelScale=1;
d.isWindowHidden=!1;d.DOMMainContainerId="main_container";d.DOMProgressContainerId="progress_container";d.DOMProgressId="progress";d.DOMScreenBackgroundContainerId="screen_background_container";d.DOMScreenBackgroundWrapperId="screen_background_wrapper";d.DOMScreenBackgroundId="screen_background";d.DOMScreenContainerId="screen_container";d.DOMScreenWrapperId="screen_wrapper";d.DOMScreenId="screen";d.DOMP2lContainerId="p2l_container";d.DOMP2lId="p2l";d.DOMMarkId="mark";d.setCookie=function(a,c){try{window.localStorage.setItem(a,
c)}catch(e){var f=new Date;f.setDate(f.getDate()+3650);document.cookie=a+"="+c+"; expires="+f.toUTCString()}};d.getCookie=function(a){var c;try{c=window.localStorage.getItem(a)}catch(e){a+="=";c=document.cookie.indexOf(a);if(-1==c)return null;var f=document.cookie.indexOf(";",c+a.length);-1==f&&(f=document.cookie.length);c=unescape(document.cookie.substring(c+a.length,f))}return c};d.bindEvent=function(a,c,e){a.addEventListener?a.addEventListener(c,e,!1):a.attachEvent&&a.attachEvent("on"+c,e)};d.getObjectLeft=
function(a){var c=a.offsetLeft;a.offsetParent&&(c+=d.getObjectLeft(a.offsetParent));return c};d.getObjectTop=function(a){var c=a.offsetTop;a.offsetParent&&(c+=d.getObjectTop(a.offsetParent));return c};d.parseGet=function(){var a={},c=window.location.toString(),e=window.location.toString().indexOf("?");if(0<=e)for(var c=c.substr(e+1,c.length),e=c.split("&"),f=0;f<e.length;f++)c=e[f].split("="),a[c[0]]=c[1];return a};d.getMouseCoord=function(a,c){var e=a||window.event;e.touches&&(e=e.touches[0]);if(!e)return{x:0,
y:0};var f=0,h=0,g=0,t=0;c&&(f=d.getObjectLeft(c),h=d.getObjectTop(c));if(e.pageX||e.pageY)g=e.pageX,t=e.pageY;else if(e.clientX||e.clientY)g=e.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft,t=e.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop;return{x:g-f,y:t-h}};d.removeFromArray=function(a,c){for(var e=[],f=0;f<a.length;f++)a[f]!=c&&e.push(a[f]);return e};d.showLoadProgress=function(a){var c=
d.globalScale,e;e="Loading: "+a+"%<br><br>";e+='<div style="display: block; background: #000; width: '+a*c*2+"px; height: "+10*c+'px;">&nbsp;</div>';document.getElementById(d.DOMProgressId).innerHTML=e};d.hideAddressBarLock=!1;d.mobileHideAddressBar=function(){d.hideAddressBarLock||window.scrollTo(0,1)};d.mobileCheckIphone4=function(){return d.touchScreen&&0<=navigator.userAgent.indexOf("iPhone")&&2==window.devicePixelRatio};d.mobileCheckBrokenAndroid=function(){return d.touchScreen&&d.isAndroid()&&
!d.isChrome()&&!d.isFirefox()};d.mobileCheckSlowDevice=function(){return d.mobileCheckBrokenAndroid()&&0<=navigator.userAgent.toLowerCase().indexOf("sm-t310")||d.touchScreen&&d.isAndroid()&&d.isFirefox()&&0<=navigator.userAgent.toLowerCase().indexOf("sm-t310")};d.isChrome=function(){var a=!1;0<=navigator.userAgent.toLowerCase().indexOf("chrome")&&(a=!0,d.isAndroid()&&22>(parseInt((/Chrome\/([0-9]+)/.exec(navigator.appVersion)||0)[1],10)||0)&&(a=!1));return a};d.isAndroid=function(){return 0<=navigator.userAgent.toLowerCase().indexOf("android")};
d.isPlayFreeBrowser=function(){return 0<=navigator.userAgent.toLowerCase().indexOf("playfreebrowser")};d.isFirefox=function(){return 0<=navigator.userAgent.toLowerCase().indexOf("firefox")};d.checkSpilgamesEnvironment=function(){return"undefined"!=typeof window.ExternalAPI&&"Spilgames"==ExternalAPI.type&&ExternalAPI.check()};d.mobileCorrectPixelRatio=function(){var a=document.createElement("meta");a.name="viewport";var c="target-densitydpi=device-dpi, user-scalable=0";d.isPlayFreeBrowser()&&(c+=", width=device-width, height=device-height");
var e=1/(window.devicePixelRatio?window.devicePixelRatio:1),e=e.toFixed(2);a.content=c+(", initial-scale="+e+", maximum-scale="+e+", minimum-scale="+e);document.getElementsByTagName("head")[0].appendChild(a)};d.getMobileScreenResolution=function(a){var c=1,e=window.innerWidth,f=window.innerHeight;e&&f||(e=screen.width,f=screen.height);var h=[{scale:1,width:320,height:480},{scale:1.5,width:480,height:720},{scale:2,width:640,height:960}],g={width:0,height:0},t="";d.touchScreen?(g.width=Math.min(e,f),
g.height=Math.max(e,f)):(a&&(h=[{scale:1,width:480,height:320},{scale:1.5,width:720,height:480},{scale:2,width:960,height:640}]),g.width=e,g.height=f);t="height";e=Number.MAX_VALUE;for(f=0;f<h.length;f++){var k=Math.abs(g[t]-h[f][t]);e>k&&(e=k,c=h[f].scale)}return d.getScaleScreenResolution(c,a)};d.getScaleScreenResolution=function(a,c){var e=Math.round(320*a),f=Math.round(480*a);return{width:c?f:e,height:c?e:f,scale:a}};d.imagesRoot="images";d.initialResolution={width:320,height:480,scale:1};d.ignoreMobileHeightCorrection=
!1;d.maxLayoutHeight=6144;d.createLayout=function(a,c,e,f){var h=d.globalScale;d.initialResolution=c;e=window.innerHeight;d.touchScreen&&!d.ignoreMobileHeightCorrection?e=d.maxLayoutHeight:document.body.style.overflow="hidden";var g;g=""+('<div id="'+d.DOMProgressContainerId+'" align="center" style="width: 100%; height: '+e+'px; display: block; width: 100%; position: absolute; left: 0px; top: 0px;">');g+='<table cellspacing="0" cellpadding="0" border="0"><tr><td id="'+d.DOMProgressId+'" align="center" valign="middle" style="width: '+
c.width+"px; height: "+c.height+"px; color: #000; background: #fff; font-weight: bold; font-family: Verdana; font-size: "+12*h+'px; vertical-align: middle;"></td></tr></table>';g=g+"</div>"+('<div id="'+d.DOMScreenBackgroundContainerId+'" style="width: 100%; height: '+e+'px; position: absolute; left: 0px; top: 0px; display: none; z-index: 2;">');g+='<div id="'+d.DOMScreenBackgroundWrapperId+'" style="width: '+c.width+"px; height: "+c.height+'px; position: relative; left: 0px; overflow: hidden;">';
f||(g+='<canvas id="'+d.DOMScreenBackgroundId+'" width="'+c.width+'" height="'+c.height+'"></canvas>');g+="</div>";g+="</div>";g+='<div id="'+d.DOMScreenContainerId+'" style="width: 100%; height: '+e+'px; position: absolute; left: 0px; top: 0px; display: none; z-index: 3;">';g+='<div id="'+d.DOMScreenWrapperId+'" width="'+c.width+'" height="'+c.height+'" style="width: '+c.width+"px; height: "+c.height+'px; position: relative; left: 0px; overflow: hidden;">';f||(g+='<canvas id="'+d.DOMScreenId+'" style="position: absolute; left: 0px; top: 0px;" width="'+
c.width+'" height="'+c.height+'">You browser does not support this application :(</canvas>');g+="</div>";g+="</div>";a.innerHTML=g;a=document.createElement("div");a.setAttribute("id",d.DOMP2lContainerId);a.setAttribute("align","center");c=c.width;a.setAttribute("style","width: 100%; height: "+e+"px; position: absolute; left: 0px; top: 0px; visibility: hidden; z-index: 1000; background: #fff;");c=(c-240)/2;d.isPlayFreeBrowser()&&(c/=8);a.innerHTML='<img id="'+d.DOMP2lId+'" src="'+d.imagesRoot+'/p2l.jpg" style="padding-top: '+
Math.floor(c)+'px" />';document.body.appendChild(a);c=document.createElement("div");c.setAttribute("id",d.DOMMarkId);c.style.position="fixed";c.style.right="0px";c.style.bottom="0px";c.style.width="1px";c.style.height="1px";c.style.background="";c.style.zIndex="100000";document.body.appendChild(c);d.fitLayoutToScreen()};d.showMainLayoutContent=function(){document.getElementById(d.DOMProgressContainerId).style.display="none";document.getElementById(d.DOMScreenContainerId).style.display="block";document.getElementById(d.DOMScreenBackgroundContainerId).style.display=
"block"};d.preventEvent=function(a){a.preventDefault();a.stopPropagation();a.cancelBubble=!0;return a.returnValue=!1};d.addMobileListeners=function(a,c){!c&&navigator.userAgent.match(/(iPad|iPhone|iPod).*CPU.*OS 7_\d/i)||d.bindEvent(document.body,"touchstart",d.preventEvent);d.isPlayFreeBrowser()||d.bindEvent(window,"scroll",function(a){setTimeout(d.mobileHideAddressBar,300)});document.addEventListener(d.getVisibiltyProps().visibilityChange,d.handleVisibilityChange,!1);setInterval("Utils.checkOrientation("+
(a?"true":"false")+")",500);setTimeout(d.mobileHideAddressBar,500)};d.handleVisibilityChange=function(){d.isWindowHidden=document[d.getVisibiltyProps().hidden];d.dispatchEvent(d.isWindowHidden?"hidewindow":"showwindow")};d.getVisibiltyProps=function(){var a,c;"undefined"!==typeof document.hidden?(a="hidden",c="visibilitychange"):"undefined"!==typeof document.mozHidden?(a="mozHidden",c="mozvisibilitychange"):"undefined"!==typeof document.msHidden?(a="msHidden",c="msvisibilitychange"):"undefined"!==
typeof document.webkitHidden&&(a="webkitHidden",c="webkitvisibilitychange");return{hidden:a,visibilityChange:c}};d.getWindowRect=function(){var a=document.getElementById(d.DOMMarkId);return d.isAndroid()&&a?{width:window.innerWidth,height:a.offsetTop+1}:{width:window.innerWidth,height:window.innerHeight}};d.storeOrient=null;d.noCheckOrient=!1;d.checkOrientation=function(a){if(d.touchScreen&&document.getElementById(d.DOMScreenContainerId)&&!d.noCheckOrient&&1!=d.parseGet().nocheckorient){var c=d.getWindowRect(),
c=c.width>c.height;d.storeOrient!==c&&(d.storeOrient=c,c!=a?(d.dispatchEvent("lockscreen"),document.getElementById(d.DOMP2lContainerId).style.visibility="visible",document.getElementById(d.DOMScreenBackgroundContainerId).style.display="none",document.getElementById(d.DOMScreenContainerId).style.display="none"):(d.dispatchEvent("unlockscreen"),document.getElementById(d.DOMP2lContainerId).style.visibility="hidden",document.getElementById(d.DOMScreenBackgroundContainerId).style.display="block",document.getElementById(d.DOMScreenContainerId).style.display=
"block"),d.checkSpilgamesEnvironment()&&(document.getElementById(d.DOMP2lContainerId).style.display="none"),setTimeout(d.mobileHideAddressBar,900),setTimeout(d.fitLayoutToScreen,1E3))}};d.fitLayoutTimer=null;d.addFitLayoutListeners=function(){d.fitLayoutTimer=setInterval(d.fitLayoutToScreen,500)};d.removeFitLayoutListeners=function(){clearInterval(d.fitLayoutTimer)};d.fitLayoutLock=!1;d.fitLayoutCorrectHeight=0;d.fitLayoutToScreen=function(a){if(!d.fitLayoutLock){var c,e,f,h;"object"==typeof a&&a.width||
(h=d.getWindowRect(),e=h.width,f=h.height,d.checkSpilgamesEnvironment()&&(f-=25),f+=d.fitLayoutCorrectHeight,a={width:e,height:f});if(c=document.getElementById(d.DOMScreenWrapperId)){c.initWidth||(c.initWidth=d.initialResolution.width,c.initHeight=d.initialResolution.height);e=c.initWidth;f=c.initHeight;var g=1,g=a.width/e;a=a.height/f;g=g<a?g:a;d.globalPixelScale=g;e=Math.floor(e*g);f=Math.floor(f*g);if(c.lastWidth!=e||c.lastHeight!=f){c.lastWidth=e;c.lastHeight=f;c=d.ignoreMobileHeightCorrection?
h.height:d.maxLayoutHeight;d.resizeElement(d.DOMScreenId,e,f);d.resizeElement(d.DOMScreenBackgroundId,e,f);d.resizeElement(d.DOMProgressContainerId,h.width,c);d.resizeElement(d.DOMProgressId,e,f);if(c=d.resizeElement(d.DOMScreenWrapperId,e,f))c.style.left=Math.floor((h.width-e)/2)+"px";if(c=d.resizeElement(d.DOMScreenBackgroundWrapperId,e,f))c.style.left=Math.floor((h.width-e)/2)+"px";d.resizeElement(d.DOMP2lContainerId,h.width,h.height);d.resizeElement(d.DOMScreenContainerId,h.width,h.height);d.resizeElement(d.DOMScreenBackgroundContainerId,
h.width,h.height);d.dispatchEvent("fitlayout");d.isPlayFreeBrowser()&&window.scrollTo(1,2);setTimeout(d.mobileHideAddressBar,10)}}}};d.resizeElement=function(a,c,e){a=document.getElementById(a);if(!a)return null;a.style.width=Math.floor(c)+"px";a.style.height=Math.floor(e)+"px";return a};d.drawIphoneLimiter=function(a,c){c?a.drawRectangle(240,295,480,54,"#f00",!0,.5,!0):a.drawRectangle(160,448,320,64,"#f00",!0,.5,!0)};d.drawGrid=function(a,c,e){"undefined"==typeof c&&(c=!1);"undefined"==typeof e&&
(e="#FFF");var f=c?480:320;c=c?320:480;for(var d=10;d<f;d+=10){var g=.1+(d-10)/10%10*.1;a.drawLine(d,0,d,c,1,e,g)}for(d=10;d<c;d+=10)g=.1+(d-10)/10%10*.1,a.drawLine(0,d,f,d,1,e,g)};d.drawScaleFix=function(a,c){.75==d.globalScale&&(c?a.drawRectangle(507,160,54,320,"#000",!0,1,!0):a.drawRectangle(160,507,320,54,"#000",!0,1,!0));1.5==d.globalScale&&(c?a.drawRectangle(510,160,60,320,"#000",!0,1,!0):a.drawRectangle(160,510,320,60,"#000",!0,1,!0))};d.grad2radian=function(a){return a/(180/Math.PI)};d.radian2grad=
function(a){return 180/Math.PI*a};d.eventsListeners=[];d.onlockscreen=null;d.onunlockscreen=null;d.onhidewindow=null;d.onshowwindow=null;d.onfitlayout=null;d.addEventListener=function(a,c){A.addEvent(d,a,c)};d.removeEventListener=function(a,c){A.removeEvent(d,a,c)};d.dispatchEvent=function(a,c){return A.dispatchEvent(d,a,c)};d.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};d.isPlainObject=function(a){return a&&a.constructor?a.constructor===Object:!1};d.getFunctionArguments=
function(a,c){"undefined"==typeof c&&(c=0);return[].slice.call(a,c)};d.proxy=function(a,c){var e=d.getFunctionArguments(arguments,2);return function(){return a.apply(c||this,d.getFunctionArguments(arguments,0).concat(e))}};d.extend=function(a,c){var e=function(){};e.prototype=c.prototype;a.prototype=new e;a.prototype.constructor=a;a.superclass=c.prototype};d.callSuperConstructor=function(a,c){a.superclass.constructor.apply(c,d.getFunctionArguments(arguments,2))};d.callSuperMethod=function(a,c,e){return a.superclass[e].apply(c,
d.getFunctionArguments(arguments,3))};d.copyObjectProps=function(a,c){for(var e in a)if(a.hasOwnProperty(e))if(d.isArray(a[e])){c[e]=[];for(var f=0;f<a[e].length;f++)"object"==typeof a[e][f]&&(c[e][f]=d.cloneEmptyObject(a[e][f])),d.copyObjectProps(a[e][f],c[e][f])}else d.isPlainObject(a[e])?d.copyObjectProps(a[e],c[e]):c[e]=a[e]};d.cloneEmptyObject=function(a){return a.constructor?new a.constructor:{}};d.clone=function(a){if(!a||"object"!=typeof a)return a;var c=d.cloneEmptyObject(a);d.copyObjectProps(a,
c);return c};d.switchToTimeMode=function(a){s.STEP_TYPE=s.STEP_BY_TIME;w.TIMEOUT_TYPE=w.TIMEOUT_BY_TIME;p.CHANGE_FRAME_TYPE=p.CHANGE_FRAME_BY_TIME;p.CHANGE_FRAME_DELAY=a};d.getGameID=function(){if(window.GAME_ID&&"my_game"!=window.GAME_ID)return window.GAME_ID;for(var a=window.location.toString().split("/"),c="";!c;)c=a.pop(),1<c.split(".").length&&(c=""),0==a.length&&(c="my_game");return c};d.ajax=function(a,c,e,f,h,g){var t;t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");
t.onreadystatechange=function(){if(4==t.readyState)if(200==t.status){var a=t.responseText;"json"==f&&(a=JSON.parse(a));"xml"==f&&(a=d.parseXMLString(a));h&&h(a,t)}else g&&g(t.status,t)};if(e){var k=[],l;for(l in e)k.push(encodeURIComponent(l)+"="+encodeURIComponent(e[l]));e=k.join("&")}else e="";c||(c="GET");t.open(c,a+("GET"==c?"?"+e:""),!0);"POST"==c&&t.setRequestHeader("Content-type","application/x-www-form-urlencoded");t.send("GET"!=c?e:null)};d.get=function(a,c,e,f,h){d.ajax(a,"GET",c,e,f,h)};
d.post=function(a,c,e,f,h){d.ajax(a,"POST",c,e,f,h)};d.getBezierBasis=function(a,c,e){function f(a){return 1>=a?1:a*f(a-1)}return f(c)/(f(a)*f(c-a))*Math.pow(e,a)*Math.pow(1-e,c-a)};d.getBezierCurve=function(a,c){"undefined"==typeof c&&(c=.1);var e=[];c/=a.length;for(var f=0;f<1+c;f+=c){1<f&&(f=1);var h=e.length;e[h]={x:0,y:0};for(var g=0;g<a.length;g++){var t=d.getBezierBasis(g,a.length-1,f);e[h].x+=a[g].x*t;e[h].y+=a[g].y*t}}return e};d.parseXMLString=function(a){var c=null;if("undefined"!=typeof window.DOMParser)c=
(new window.DOMParser).parseFromString(a,"text/xml");else if("undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM"))c=new window.ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a);else throw Error("No XML parser found");return c};(u||window).Utils=d;E.prototype.load=function(a,c,e){this.data=a;this.endCallback=c;this.processCallback=e;for(a=0;a<this.data.length;a++)c=this.data[a],e=new Image,e.src=c.src,this.loadedImages[c.name]=e;this.wait()};E.prototype.wait=
function(){var a=0,c=0,e;for(e in this.loadedImages)this.loadedImages[e].complete&&a++,c++;a>=c?this.endCallback&&this.endCallback(this.loadedImages):(this.processCallback&&this.processCallback(Math.floor(a/c*this.maxProgressVal+this.minProgressVal)),setTimeout(this.wait,50))};(u||window).ImagesPreloader=E;B.prototype.isMp3Support=function(){return""!=document.createElement("audio").canPlayType("audio/mpeg")};B.prototype.isWebAudio=function(){return Boolean(window.AudioMixer)&&AudioMixer.isWebAudioSupport()};
B.prototype.load=function(a,c,e){a&&(this.sounds=a);c&&(this.endCallback=c);e&&(this.progressCallback=e);if(!this.sounds||1>this.sounds.length||!this.isWebAudio())this.endCallback&&this.endCallback();else{a=this.isMp3Support()?"mp3":"ogg";var f;this.loadedCount=0;var h=this;for(e=0;e<this.sounds.length;e++)c=this.sounds[e]+"."+a,this.isWebAudio()?(f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),f.open("GET",c,!0),f.responseType="arraybuffer",f.onreadystatechange=
function(){if(4==this.readyState&&200==this.status){var a=this.soundSrc;AudioMixer.waContext||(AudioMixer.waContext=new AudioContext);AudioMixer.waContext.decodeAudioData(this.response,function(c){AudioMixer.buffer[a]=c;h.soundIsLoaded(null,h)},function(a){h.soundIsLoaded(null,h)})}},f.soundSrc=c,f.send()):(f=document.createElement("audio"),f.src=c,f.type="mp3"==a?"audio/mpeg":"audio/ogg",f.preload="auto",f.load(),f.addEventListener("canplay",d.proxy(this.soundIsLoaded,f,this)),f.addEventListener("canplaythrough",
d.proxy(this.soundIsLoaded,f,this)))}};B.prototype.soundIsLoaded=function(a,c){if(this.nodeName&&"audio"==this.nodeName.toLowerCase()){if(this.alreadyLoaded)return;this.alreadyLoaded=!0}c.loadedCount++;c.progressCallback&&c.progressCallback(Math.floor(c.loadedCount/c.sounds.length*c.maxProgressVal+c.minProgressVal));c.loadedCount>=c.sounds.length&&c.endCallback&&c.endCallback()};(u||window).SoundsPreloader=B;C.prototype.detectSize=function(){if(!this.bitmap)return!1;try{isNaN(this.width)&&(this.width=
this.bitmap.width?parseInt(this.bitmap.width):0),isNaN(this.height)&&(this.height=this.bitmap.height?parseInt(this.bitmap.height):0)}catch(a){}return!isNaN(this.width)&&!isNaN(this.height)};C.prototype.normalize=function(a){if(!this.ready&&this.detectSize()){if(isNaN(this.frames)||1>this.frames)this.frames=1;if(isNaN(this.layers)||1>this.layers)this.layers=1;this.width=Math.ceil(this.width/this.layers/a);this.height=Math.ceil(this.height/this.frames/a);this.ready=!0}};(u||window).Asset=C;x.prototype.init=
function(a,c){"undefined"!=typeof a&&(this.path=a+"");"undefined"!=typeof c&&(this.scale=parseFloat(c),isNaN(this.scale)&&(this.scale=1))};x.prototype.load=function(a,c,e,f){this.onload=a;this.onloadprogress=c;a=new E;c=[];for(var d in this.items)c.push(this.items[d]);"undefined"!=typeof e&&(a.minProgressVal=e);"undefined"!=typeof f&&(a.maxProgressVal=f);a.load(c,this.onLoadHandler,this.onLoadProgressHandler)};x.prototype.onLoadProgressHandler=function(a){if("function"==typeof this.onloadprogress)this.onloadprogress(a)};
x.prototype.onLoadHandler=function(a){this.loaded=!0;for(var c in a){var e=this.items[c];e.bitmap=a[c];e.normalize(this.scale)}if("function"==typeof this.onload)this.onload(this.items)};x.prototype.addAssets=function(a){if("undefined"!=typeof a&&"object"==typeof a)for(var c=0;c<a.length;c++){var e=a[c];e.noscale="undefined"==typeof e.noscale?!1:e.noscale;e.noscale||(e.src="%SCALE%/"+e.src);this.addAsset(e)}};x.prototype.addAsset=function(a,c,e,f,d,g){var k=null;"object"==typeof a&&1==arguments.length&&
(c=a.name,e=a.width||1,f=a.height||1,d=a.frames||1,g=a.layers||1,k=a.spriteClass||null,properties=a.properties||null,a=a.src);a=a.replace("%SCALE%","%PATH%/"+this.scale);a=a.replace("%PATH%",this.path);if("undefined"==typeof c){var l=a.split("/"),l=l.pop(),l=l.split(".");c=l=l.shift()+""}l=new C(c,a,e,f,d,g);l.spriteClass=k;if(properties)for(var m in properties)"undefined"==typeof l[m]&&(l[m]=properties[m]);return this.items[c]=l};x.prototype.addObject=function(a){var c=this.addAsset("%SCALE%/"+a.image,
a.name,a.width*this.scale,a.height*this.scale,a.frames,a.layers);c&&(c.object=a);return c};x.prototype.getAsset=function(a,c){var e=null;"undefined"!=typeof this.items[a]&&this.items[a].bitmap&&(e="undefined"!=typeof c&&!c||this.items[a].ready?this.items[a]:null);if(!e)throw Error('Trying to get undefined asset "'+a+'"');return e};x.prototype.getSprite=function(a,c,e){var f=null,f=null;try{f=this.getAsset(a,!0)}catch(d){f=new C}if((e=e||f.spriteClass||this.spriteClass||window.Sprite)&&"function"==
typeof e||"function"==typeof window[e])e="function"==typeof e?e:window[e];f=e.create&&"function"==typeof e.create?e.create(f,this):new e(f.bitmap,f.width,f.height,f.frames,f.layers);if(c&&"object"==typeof c)for(var g in c)f[g]=c[g];return f};x.prototype.getBitmap=function(a){try{return this.getAsset(a,!0).bitmap}catch(c){return null}};(u||window).AssetsLibrary=x;n.prototype.isZero=function(){return 0==this.x&&0==this.y};n.prototype.clone=function(){return new n(this.x,this.y)};n.prototype.add=function(a){this.x+=
a.x;this.y+=a.y;return this};n.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;return this};n.prototype.mult=function(a){this.x*=a;this.y*=a;return this};n.prototype.invert=function(){this.mult(-1);return this};n.prototype.rotate=function(a,c){"undefined"==typeof c&&(c=new n(0,0));var e=this.clone();e.subtract(c);e.x=this.x*Math.cos(a)+this.y*Math.sin(a);e.y=this.x*-Math.sin(a)+this.y*Math.cos(a);e.add(c);this.x=e.x;this.y=e.y;return this};n.prototype.normalize=function(a,c){"undefined"==typeof c&&
(c=new n(0,0));this.subtract(c);this.rotate(-a);return this};n.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};n.prototype.distanceTo=function(a){p2=this.clone();p2.subtract(a);return p2.getLength()};(u||window).Vector=n;y.prototype.clone=function(){return new y(this.center.x,this.center.y,this.width,this.height,this.angle)};y.prototype.refreshVertices=function(){var a=this.width/2,c=this.height/2;this.vertices=[];this.vertices.push(new n(-a,c));this.vertices.push(new n(a,
c));this.vertices.push(new n(a,-c));this.vertices.push(new n(-a,-c));this.AABB=[this.center.clone(),this.center.clone()];for(a=0;4>a;a++)this.vertices[a].rotate(-this.angle,this.center),this.vertices[a].x<this.AABB[0].x&&(this.AABB[0].x=this.vertices[a].x),this.vertices[a].x>this.AABB[1].x&&(this.AABB[1].x=this.vertices[a].x),this.vertices[a].y<this.AABB[0].y&&(this.AABB[0].y=this.vertices[a].y),this.vertices[a].y>this.AABB[1].y&&(this.AABB[1].y=this.vertices[a].y)};y.prototype.move=function(a,c){this.center.add(new n(a,
c));this.refreshVertices()};y.prototype.rotate=function(a){this.angle+=a;this.refreshVertices()};y.prototype.hitTestPoint=function(a){a=a.clone();a.normalize(-this.angle,this.center);return Math.abs(a.x)<=this.width/2&&Math.abs(a.y)<=this.height/2};y.prototype.hitTestRectangle=function(a){var c=this.clone();a=a.clone();var e,f,d;c.move(-this.center.x,-this.center.y);a.move(-this.center.x,-this.center.y);a.center.rotate(this.angle);c.rotate(-this.angle);a.rotate(-this.angle);e=Math.max(c.AABB[0].x,
c.AABB[1].x,a.AABB[0].x,a.AABB[1].x)-Math.min(c.AABB[0].x,c.AABB[1].x,a.AABB[0].x,a.AABB[1].x);f=c.AABB[1].x-c.AABB[0].x;d=a.AABB[1].x-a.AABB[0].x;if(e>f+d)return!1;e=Math.max(c.AABB[0].y,c.AABB[1].y,a.AABB[0].y,a.AABB[1].y)-Math.min(c.AABB[0].y,c.AABB[1].y,a.AABB[0].y,a.AABB[1].y);f=c.AABB[1].y-c.AABB[0].y;d=a.AABB[1].y-a.AABB[0].y;if(e>f+d)return!1;c.move(-a.center.x,-a.center.y);a.move(-a.center.x,-a.center.y);c.center.rotate(a.angle);c.refreshVertices();c.rotate(-a.angle);a.rotate(-a.angle);e=
Math.max(c.AABB[0].x,c.AABB[1].x,a.AABB[0].x,a.AABB[1].x)-Math.min(c.AABB[0].x,c.AABB[1].x,a.AABB[0].x,a.AABB[1].x);f=c.AABB[1].x-c.AABB[0].x;d=a.AABB[1].x-a.AABB[0].x;if(e>f+d)return!1;e=Math.max(c.AABB[0].y,c.AABB[1].y,a.AABB[0].y,a.AABB[1].y)-Math.min(c.AABB[0].y,c.AABB[1].y,a.AABB[0].y,a.AABB[1].y);f=c.AABB[1].y-c.AABB[0].y;d=a.AABB[1].y-a.AABB[0].y;return e>f+d?!1:!0};(u||window).Rectangle=y;var A={addEvent:function(a,c,e){if(a.eventsListeners){for(var f=0;f<a.eventsListeners.length;f++)if(a.eventsListeners[f].type===
c&&a.eventsListeners[f].callback===e)return;a.eventsListeners.push({type:c,callback:e})}},removeEvent:function(a,c,e){if(a.eventsListeners)for(var f=0;f<a.eventsListeners.length;f++)if(a.eventsListeners[f].type===c&&a.eventsListeners[f].callback===e){a.eventsListeners=d.removeFromArray(a.eventsListeners,a.eventsListeners[f]);break}},dispatchEvent:function(a,c,e){if(a.eventsListeners){var f;if("function"==typeof a["on"+c]&&(f=a["on"+c](e),!1===f))return!1;for(var d=0;d<a.eventsListeners.length;d++)if(a.eventsListeners[d].type===
c&&(f=a.eventsListeners[d].callback(e),!1===f))return!1}},hasEventListener:function(a,c){if(a.eventsListeners){for(var e=0;e<a.eventsListeners.length;e++)if(a.eventsListeners[e].type===c)return!0;return!1}},removeAllEventListeners:function(a,c){if(a.eventsListeners){"undefined"==typeof c&&(a.eventsListeners=[]);for(var e=[],f=0;f<a.eventsListeners.length;f++)a.eventsListeners[f].type!==c&&e.push(a.eventsListeners[f]);a.eventsListeners=e}}};(u||window).EventsManager=A;z.prototype.addEventListener=
function(a,c){A.addEvent(this,a,c)};z.prototype.removeEventListener=function(a,c){A.removeEvent(this,a,c)};z.prototype.dispatchEvent=function(a,c){return A.dispatchEvent(this,a,c)};z.prototype.hasEventListener=function(a){return A.hasEventListener(this,a)};z.prototype.removeAllEventListeners=function(a){A.removeAllEventListeners(this,a)};(u||window).EventsProxy=z;var D={back:{easeIn:function(a,c,e,f){return e*(a/=f)*a*(2.70158*a-1.70158)+c},easeOut:function(a,c,e,f){return e*((a=a/f-1)*a*(2.70158*
a+1.70158)+1)+c},easeInOut:function(a,c,e,f){var d=1.70158;return 1>(a/=f/2)?e/2*a*a*(((d*=1.525)+1)*a-d)+c:e/2*((a-=2)*a*(((d*=1.525)+1)*a+d)+2)+c}},bounce:{easeIn:function(a,c,e,d){return e-D.bounce.easeOut(d-a,0,e,d)+c},easeOut:function(a,c,e,d){return(a/=d)<1/2.75?7.5625*e*a*a+c:a<2/2.75?e*(7.5625*(a-=1.5/2.75)*a+.75)+c:a<2.5/2.75?e*(7.5625*(a-=2.25/2.75)*a+.9375)+c:e*(7.5625*(a-=2.625/2.75)*a+.984375)+c},easeInOut:function(a,c,e,d){return a<d/2?.5*D.bounce.easeIn(2*a,0,e,d)+c:.5*D.bounce.easeOut(2*
a-d,0,e,d)+.5*e+c}},circular:{easeIn:function(a,c,e,d){return-e*(Math.sqrt(1-(a/=d)*a)-1)+c},easeOut:function(a,c,e,d){return e*Math.sqrt(1-(a=a/d-1)*a)+c},easeInOut:function(a,c,e,d){return 1>(a/=d/2)?-e/2*(Math.sqrt(1-a*a)-1)+c:e/2*(Math.sqrt(1-(a-=2)*a)+1)+c}},cubic:{easeIn:function(a,c,e,d){return e*(a/=d)*a*a+c},easeOut:function(a,c,e,d){return e*((a=a/d-1)*a*a+1)+c},easeInOut:function(a,c,e,d){return 1>(a/=d/2)?e/2*a*a*a+c:e/2*((a-=2)*a*a+2)+c}},exponential:{easeIn:function(a,c,e,d){return 0==
a?c:e*Math.pow(2,10*(a/d-1))+c},easeOut:function(a,c,e,d){return a==d?c+e:e*(-Math.pow(2,-10*a/d)+1)+c},easeInOut:function(a,c,e,d){return 0==a?c:a==d?c+e:1>(a/=d/2)?e/2*Math.pow(2,10*(a-1))+c:e/2*(-Math.pow(2,-10*--a)+2)+c}},linear:{easeIn:function(a,c,e,d){return e*a/d+c},easeOut:function(a,c,e,d){return e*a/d+c},easeInOut:function(a,c,e,d){return e*a/d+c}},quadratic:{easeIn:function(a,c,e,d){return e*(a/=d)*a+c},easeOut:function(a,c,e,d){return-e*(a/=d)*(a-2)+c},easeInOut:function(a,c,e,d){return 1>
(a/=d/2)?e/2*a*a+c:-e/2*(--a*(a-2)-1)+c}},quartic:{easeIn:function(a,c,e,d){return e*(a/=d)*a*a*a+c},easeOut:function(a,c,e,d){return-e*((a=a/d-1)*a*a*a-1)+c},easeInOut:function(a,c,e,d){return 1>(a/=d/2)?e/2*a*a*a*a+c:-e/2*((a-=2)*a*a*a-2)+c}},quintic:{easeIn:function(a,c,e,d){return e*(a/=d)*a*a*a*a+c},easeOut:function(a,c,e,d){return e*((a=a/d-1)*a*a*a*a+1)+c},easeInOut:function(a,c,e,d){return 1>(a/=d/2)?e/2*a*a*a*a*a+c:e/2*((a-=2)*a*a*a*a+2)+c}},sine:{easeIn:function(a,c,e,d){return-e*Math.cos(a/
d*(Math.PI/2))+e+c},easeOut:function(a,c,e,d){return e*Math.sin(a/d*(Math.PI/2))+c},easeInOut:function(a,c,e,d){return-e/2*(Math.cos(Math.PI*a/d)-1)+c}}};(u||window).Easing=D;d.extend(s,z);s.prototype.play=function(){this.playing=!0;this.tick(0)};s.prototype.pause=function(){this.playing=!1};s.prototype.rewind=function(){this._pos=-1};s.prototype.forward=function(){this._pos=this.duration};s.prototype.stop=function(){this.pause();this.rewind()};s.prototype.updateValue=function(a){this.obj?this.obj[this.prop]=
a:this.prop=a};s.prototype.tick=function(a){if(!this.playing)return!1;a||(a=0);s.STEP_TYPE==s.STEP_BY_FRAME?this._pos++:this._pos+=a;if(0>this._pos)return!1;if(this._pos>this.duration)return this.finish();a=this.callback;a=a(this._pos,this.start,this.end-this.start,this.duration);this.updateValue(a);this.dispatchEvent("change",{target:this,value:a});return!1};s.prototype.finish=function(){this.stop();this.updateValue(this.end);return!1===this.dispatchEvent("finish",{target:this,value:this.end})?!1:
!0};s.STEP_BY_FRAME=0;s.STEP_BY_TIME=1;s.STEP_TYPE=s.STEP_BY_FRAME;(u||window).Tween=s;d.extend(l,z);l.prototype.getAbsoluteRotation=function(){return this.rotation+(this.parent?this.parent.getAbsoluteRotation():0)};l.prototype.getAbsoluteOpacity=function(){return this.opacity*(this.parent?this.parent.getAbsoluteOpacity():1)};l.prototype.getAbsoluteScaleX=function(){return this.scaleX*(this.parent?this.parent.getAbsoluteScaleX():1)};l.prototype.getAbsoluteScaleY=function(){return this.scaleY*(this.parent?
this.parent.getAbsoluteScaleY():1)};l.prototype.getAbsoluteSkewX=function(){return this.skewX+(this.parent?this.parent.getAbsoluteSkewX():0)};l.prototype.getAbsoluteSkewY=function(){return this.skewY+(this.parent?this.parent.getAbsoluteSkewY():0)};l.prototype.render=function(a,c,e){for(var d=0;d<this.objects.length;d++)obj=this.objects[d],obj.destroy?(this.removeChild(obj),d--):obj.visible&&obj.render(a,c,e)};l.prototype.getX=function(){return Math.round(this.x*d.globalScale)};l.prototype.getY=function(){return Math.round(this.y*
d.globalScale)};l.prototype.getWidth=function(){return this.width*Math.abs(this.getAbsoluteScaleX())*d.globalScale};l.prototype.getHeight=function(){return this.height*Math.abs(this.getAbsoluteScaleY())*d.globalScale};l.prototype.getPosition=function(){return{x:this.x,y:this.y}};l.prototype.setPosition=function(a,c){if("undefined"==typeof c&&"undefined"!=typeof a.x&&"undefined"!=typeof a.y)return this.setPosition(a.x,a.y);this.x=parseFloat(a);this.y=parseFloat(c)};l.prototype.setPropScale=function(a){this.scaleX=
this.scaleY=1*a};l.prototype.getAnchor=function(){return this.anchor};l.prototype.setAnchor=function(a,c){if("undefined"==typeof c&&"undefined"!=typeof a.x&&"undefined"!=typeof a.y)return this.setAnchor(a.x,a.y);this.anchor.x=parseFloat(a);this.anchor.y=parseFloat(c)};l.prototype.alignAnchor=function(a,c){a=parseInt(a);isNaN(a)&&(a=l.ANCHOR_ALIGN_CENTER);0>a&&(a=l.ANCHOR_ALIGN_LEFT);0<a&&(a=l.ANCHOR_ALIGN_RIGHT);c=parseInt(c);isNaN(c)&&(c=l.ANCHOR_VALIGN_MIDDLE);0>c&&(c=l.ANCHOR_VALIGN_TOP);0<c&&
(c=l.ANCHOR_VALIGN_BOTTOM);this.anchor.x=this.width*a/2;this.anchor.y=this.height*c/2;return this.getAnchor()};l.prototype.getAbsoluteAnchor=function(){return this.getPosition()};l.prototype.getRelativeCenter=function(){var a=this.getAnchor(),c=this.getAbsoluteRotation(),a={x:a.x,y:a.y};0!=c?(a=new n(-a.x*this.getAbsoluteScaleX(),-a.y*this.getAbsoluteScaleY()),a.rotate(-c)):(a.x=-(a.x*this.getAbsoluteScaleX()),a.y=-(a.y*this.getAbsoluteScaleY()));return a};l.prototype.getAbsolutePosition=function(){var a=
{x:this.x,y:this.y};if(this.parent){var c=this.parent.getAbsolutePosition(),e=this.parent.getAbsoluteRotation();if(0!=e){var d=new n(a.x*this.parent.getAbsoluteScaleX(),a.y*this.parent.getAbsoluteScaleY());d.rotate(-e);a.x=c.x+d.x;a.y=c.y+d.y}else a.x=c.x+a.x*this.parent.getAbsoluteScaleX(),a.y=c.y+a.y*this.parent.getAbsoluteScaleY()}return a};l.prototype.getAbsoluteCenter=function(){var a=this.getAbsolutePosition(),c=this.getRelativeCenter();a.x+=c.x;a.y+=c.y;return a};l.prototype.getCenter=function(){return this.getAbsoluteCenter()};
l.prototype.getHitAreaRectangle=function(){if(!this.hitArea)return this.getDrawRectangle();var a=this.getAbsoluteRotation(),c=this.getAbsoluteScaleX(),e=this.getAbsoluteScaleY(),d=this.getCenter(),h=new y(0,0,this.hitArea.width*Math.abs(c),this.hitArea.height*Math.abs(e),a);0!=a?(c=new n(this.hitArea.x*c,this.hitArea.y*e),c.rotate(-a),h.move(d.x+c.x,d.y+c.y)):h.move(d.x+this.hitArea.x*c,d.y+this.hitArea.x*e);return h};l.prototype.getDrawRectangle=function(){var a=this.getCenter(),c=new y(0,0,this.width*
Math.abs(this.getAbsoluteScaleX()),this.height*Math.abs(this.getAbsoluteScaleY()),this.getAbsoluteRotation());c.move(a.x,a.y);return c};l.prototype.getAABBRectangle=function(){var a=this.getDrawRectangle(),c=a.AABB[1].x-a.AABB[0].x,e=a.AABB[1].y-a.AABB[0].y;return new y(a.AABB[0].x+c/2,a.AABB[0].y+e/2,c,e,0)};l.prototype.localToGlobal=function(a,c){var e="object"==typeof a&&"undefined"!=typeof a.x&&"undefined"!=typeof a.y?new n(a.x+0,a.y+0):new n(a,c);e.rotate(this.getAbsoluteRotation()).add(this.getAbsolutePosition());
return e};l.prototype.globalToLocal=function(a,c){var e="object"==typeof a&&"undefined"!=typeof a.x&&"undefined"!=typeof a.y?new n(a.x+0,a.y+0):new n(a,c);e.subtract(this.getAbsolutePosition()).rotate(this.getAbsoluteRotation());return e};l.prototype.findMaxZIndex=function(){for(var a=-1,c=!1,e=0;e<this.objects.length;e++)this.objects[e].zIndex>a&&(a=this.objects[e].zIndex,c=e);return{index:c,zIndex:a}};l.prototype.findMinZIndex=function(){for(var a=-1,c=!1,e=0;e<this.objects.length;e++)0==e&&(a=
this.objects[e].zIndex,c=0),this.objects[e].zIndex<a&&(a=this.objects[e].zIndex,c=e);return{index:c,zIndex:a}};l.prototype.addChild=function(a){var c=this.findMaxZIndex(),e=a.zIndex;a.zIndex=!1!==c.index?c.zIndex+1:0;this.objectsCounter++;a.uid=this.objectsCounter;a.parent=this;a.setStage(this.stage);this.objects.push(a);0!=e&&this.setChildZIndex(a,~~e);a.dispatchEvent("add",{target:a});return a};l.prototype.setStage=function(a){this.stage=a;for(var c=0;c<this.objects.length;c++)this.objects[c].setStage(a)};
l.prototype.removeChild=function(a){a&&0<=this.objects.indexOf(a)&&(a.clear(),a.removeAllEventListeners(),a.dispatchEvent("remove",{target:a}),a.parent=null,this.objects=d.removeFromArray(this.objects,a))};l.prototype.setChildZIndex=function(a,c){a.zIndex=c;this.objects=this.objects.sort(function(a,c){return a.zIndex==c.zIndex?a.uid>c.uid?1:-1:a.zIndex>c.zIndex?1:-1})};l.prototype.getHitArea=function(){return this.hitArea?this.hitArea:{x:0,y:0,width:this.width,height:this.height}};l.prototype.hitTestPointObject=
function(a,c,e,f,h){var g,k,l,m,p,v,r;"boolean"==typeof a.pixelCheck&&(f=a.pixelCheck);r=a.getHitArea();l=r.width*Math.abs(a.getAbsoluteScaleX());m=r.height*Math.abs(a.getAbsoluteScaleY());p=a.getAbsoluteCenter();g=p.x+r.x-l/2;k=p.y+r.y-m/2;p=c;v=e;a.ignoreViewport||(p+=this.stage.viewport.x,v+=this.stage.viewport.y);r=!1;0==a.getAbsoluteRotation()?g<=p&&k<=v&&g+l>=p&&k+m>=v&&(r=!0):(g=a.getHitAreaRectangle(),g.hitTestPoint(new n(p,v))&&(r=!0));r&&f&&(this.stage.buffer.width=this.stage.canvas.width,
this.stage.buffer.height=this.stage.canvas.height,this.stage.clearScreen(this.stage.buffer),a.render(this.stage.buffer,a.static,0),c=this.stage.buffer.ctx.getImageData(Math.floor(c*d.globalScale),Math.floor(e*d.globalScale),1,1),0==c.data[3]&&(r=!1));!r&&h&&a.dragged&&(r=!0);return r};l.prototype.getObjectsStackByCoord=function(a,c,e,d){for(var h,g=[],k=this.objects.length-1;0<=k;k--)this.objects[k].visible&&(h=this.objects[k],h.objects&&h.objects.length&&(g=g.concat(h.getObjectsStackByCoord(a,c,
e,d))),this.hitTestPointObject(h,a,c,e,d)&&g.push(h));return g};l.prototype.doDrag=function(a,c){for(var e=0;e<this.objects.length;e++)this.objects[e].doDrag(a,c);if(this.dragged){var e=a,d=c;this.ignoreViewport||(e+=this.stage.viewport.x,d+=this.stage.viewport.y);this.x=e-this.dragX;this.y=d-this.dragY}};l.prototype.checkMouseOut=function(a,c){for(var e=this.objects.length-1;0<=e;e--)if(!1===this.objects[e].checkMouseOut(a,c))return;if(this.mouseOn&&0>a.indexOf(this))return this.mouseOn=!1,e=this.stage.finalizeMouseCoords(this,
c),this.dispatchEvent("mouseout",{target:this,x:e.x,y:e.y})};l.prototype.getMaxZIndexInStack=function(a){for(var c=-1,e=0,d=0;d<a.length;d++)a[d].zIndex>c&&(c=a[d].zIndex,e=d);return e};l.prototype.sortStack=function(a,c){return a.sort(function(a,d){a.zIndex==d.zIndex?c?a.uid<d.uid?1:-1:a.uid>d.uid?1:-1:c?a.zIndex<d.zIndex?1:-1:a.zIndex>d.zIndex?1:-1})};l.prototype.clear=function(){for(;this.objects.length;)this.removeChild(this.objects[0])};l.prototype.getFillStyle=function(a){var c=null;if(this.fillLinearGradient){a=
a.ctx.createLinearGradient(this.fillLinearGradient.x0*d.globalScale,this.fillLinearGradient.y0*d.globalScale,this.fillLinearGradient.x1*d.globalScale,this.fillLinearGradient.y1*d.globalScale);for(c=0;c<this.fillLinearGradient.points.length;c++)a.addColorStop(this.fillLinearGradient.points[c].point,this.fillLinearGradient.points[c].color);c=a}else if(this.fillRadialGradient){a=a.ctx.createRadialGradient(this.fillRadialGradient.x0*d.globalScale,this.fillRadialGradient.y0*d.globalScale,this.fillRadialGradient.r0*
d.globalScale,this.fillRadialGradient.x1*d.globalScale,this.fillRadialGradient.y1*d.globalScale,this.fillRadialGradient.r1*d.globalScale);for(c=0;c<this.fillRadialGradient.points.length;c++)a.addColorStop(this.fillRadialGradient.points[c].point,this.fillRadialGradient.points[c].color);c=a}else c=this.fillPattern?a.ctx.createPattern(this.fillPattern.img,this.fillPattern.repeat):this.fillColor;return c};l.ANCHOR_ALIGN_LEFT=-1;l.ANCHOR_ALIGN_CENTER=0;l.ANCHOR_ALIGN_RIGHT=1;l.ANCHOR_VALIGN_TOP=-1;l.ANCHOR_VALIGN_MIDDLE=
0;l.ANCHOR_VALIGN_BOTTOM=1;(u||window).DisplayObjectContainer=l;d.extend(q,l);q.prototype.setStatic=function(a){a=Boolean(a);for(var c=0;c<this.objects.length;c++)this.objects[c].setStatic(a);return this.static!=a?(this.static=a,this.stage&&this.stage.refreshBackground(),!0):!1};q.prototype.startDrag=function(a,c){this.dragged=!0;this.dragX=a;this.dragY=c};q.prototype.stopDrag=function(){this.dragged=!1;this.dragY=this.dragX=0};q.prototype.removeTweens=function(){this.stage&&this.stage.clearObjectTweens(this)};
q.prototype.addTween=function(a,c,e,d,h,g){if(this.stage){var k=this[a];if(!isNaN(k))return a=this.stage.createTween(this,a,k,c,e,d),a.onchange=g,a.onfinish=h,a}};q.prototype.moveTo=function(a,c,e,d,h,g){e=~~e;0>=e?this.setPosition(a,c):((a=this.addTween("x",a,e,d))&&a.play(),(c=this.addTween("y",c,e,d,h,g))&&c.play());return this};q.prototype.moveBy=function(a,c,e,d,h,g){return this.moveTo(this.x+a,this.y+c,e,d,h,g)};q.prototype.fadeTo=function(a,c,e,d,h){c=~~c;0>=c?this.opacity=a:(a=this.addTween("opacity",
a,c,e,d,h))&&a.play();return this};q.prototype.fadeBy=function(a,c,e,d,h){a=Math.max(0,Math.min(1,this.opacity+a));return this.fadeTo(a,c,e,d,h)};q.prototype.rotateTo=function(a,c,e,d,h){c=~~c;0>=c?this.rotation=a:(a=this.addTween("rotation",a,c,e,d,h))&&a.play();return this};q.prototype.rotateBy=function(a,c,e,d,h){return this.rotateTo(this.rotation+a,c,e,d,h)};q.prototype.skewXTo=function(a,c,e,d,h){c=~~c;0>=c?this.skewX=a:(a=this.addTween("skewX",a,c,e,d,h))&&a.play();return this};q.prototype.skewXBy=
function(a,c,e,d,h){return this.skewXTo(this.skewX+a,c,e,d,h)};q.prototype.skewYTo=function(a,c,e,d,h){c=~~c;0>=c?this.skewY=a:(a=this.addTween("skewY",a,c,e,d,h))&&a.play();return this};q.prototype.skewYBy=function(a,c,e,d,h){return this.skewYTo(this.skewY+a,c,e,d,h)};q.prototype.scaleTo=function(a,c,e,d,h){c=~~c;if(0>=c)this.scaleX=this.scaleY=a;else{var g=this.addTween("scaleX",a,c,e,d,h);g&&g.play();(a=this.addTween("scaleY",a,c,e,g?null:d,g?null:h))&&a.play()}return this};q.prototype.setZIndex=
function(a){this.zIndex=~~a;this.parent&&this.parent.setChildZIndex(this,this.zIndex)};q.prototype.hitTestPoint=function(a,c,e,d,h){return this.stage?this.stage.hitTestPointObject(this,a,c,e,d,h):!1};q.prototype.setRelativePosition=function(a,c,e,d){switch(e){case "right":a=this.stage.screenWidth-a;break;case "left":break;default:a=this.stage.screenWidth/2+a}switch(d){case "bottom":c=this.stage.screenHeight-c;break;case "top":break;default:c=this.stage.screenHeight/2+c}this.setPosition(a,c)};q.prototype.debugDraw=
function(){if(this.visible&&this.allowDebugDrawing){var a=this.getAbsolutePosition(),c=this.getCenter(),e=this.getDrawRectangle(),d=this.getAABBRectangle();stage.drawCircle(a.x,a.y,1,1,"rgba(255,0,0,0.9)");stage.drawCircle(c.x,c.y,1,1,"rgba(0,255,0,0.9)");stage.drawLine(a.x,a.y,c.x,c.y,1,"rgba(255,255,255,0.5)");stage.drawPolygon(e.vertices,.5,"rgba(255,0,255,0.5)",1);stage.drawLine(d.vertices[0].x,d.vertices[0].y,d.vertices[2].x,d.vertices[2].y,1,"rgba(255,255,255,0.5)");stage.drawLine(d.vertices[2].x,
d.vertices[0].y,d.vertices[0].x,d.vertices[2].y,1,"rgba(255,255,255,0.5)");stage.drawPolygon(d.vertices,.5,"rgba(255,255,255,0.5)")}};q.prototype.clone=function(){return d.clone(this)};(u||window).DisplayObject=q;d.extend(k,q);k.prototype.render=function(a,c,e){!!this.static==!!c&&this.dispatchEvent("render",{target:this,canvas:a,delta:e});d.callSuperMethod(k,this,"render",a,c,e)};k.prototype.prepareCanvas=function(a,c){c.ctx.save();this.ignoreViewport||(a.x-=this.stage.viewport.x,a.y-=this.stage.viewport.y);
a.x*=d.globalScale;a.y*=d.globalScale;c.ctx.translate(a.x,a.y);var e=this.getAbsoluteRotation();c.ctx.rotate(e);c.ctx.scale(this.getAbsoluteScaleX(),this.getAbsoluteScaleY());var f=this.getAbsoluteSkewX(),h=this.getAbsoluteSkewY();0==f&&0==h||c.ctx.transform(1,f,h,1,0,0);this.shadowColor&&(c.ctx.shadowColor=this.shadowColor,0!=e?(f=new n(this.shadowOffsetX*d.globalScale,this.shadowOffsetY*d.globalScale),f.rotate(-e),c.ctx.shadowOffsetX=f.x,c.ctx.shadowOffsetY=f.y):(c.ctx.shadowOffsetX=this.shadowOffsetX*
d.globalScale,c.ctx.shadowOffsetY=this.shadowOffsetY*d.globalScale),c.ctx.shadowBlur=this.shadowBlur*d.globalScale)};k.prototype.preparePath=function(a){a.ctx.beginPath();a.ctx.strokeStyle=0<this.lineWidth?this.color:"transparent";a.ctx.lineWidth=this.lineWidth*d.globalScale;a.ctx.globalAlpha=this.getAbsoluteOpacity();a.ctx.fillStyle=this.getFillStyle(a)};k.prototype.finalizeCanvas=function(a){(this.fillColor||this.fillLinearGradient||this.fillRadialGradient||this.fillPattern)&&a.ctx.fill();a.ctx.stroke()};
k.prototype.restoreCanvas=function(a){a.ctx.restore()};k.circle=function(a,c,e){d.callSuperConstructor(k.circle,this);this.x=a;this.y=c;this.radius=e;this.width=2*e;this.height=2*e};d.extend(k.circle,k);k.circle.prototype.render=function(a,c,e){!!this.static==!!c&&(this.prepareCanvas(this.getAbsoluteCenter(),a),this.preparePath(a),a.ctx.arc(0,0,this.radius*d.globalScale,0,2*Math.PI),this.finalizeCanvas(a),this.restoreCanvas(a));d.callSuperMethod(k.circle,this,"render",a,c,e)};k.line=function(a,c,
e,f){d.callSuperConstructor(k.line,this);this.x1=a;this.x2=e;this.y1=c;this.y2=f};d.extend(k.line,k);k.line.prototype.render=function(a,c,e){!!this.static==!!c&&(this.prepareCanvas(this.getAbsoluteCenter(),a),this.preparePath(a),a.ctx.moveTo(this.x1*d.globalScale,this.y1*d.globalScale),a.ctx.lineTo(this.x2*d.globalScale,this.y2*d.globalScale),this.finalizeCanvas(a),this.restoreCanvas(a));d.callSuperMethod(k.line,this,"render",a,c,e)};k.rectangle=function(a,c,e,f){d.callSuperConstructor(k.rectangle,
this);this.x=a;this.y=c;this.width=e;this.height=f};d.extend(k.rectangle,k);k.rectangle.prototype.render=function(a,c,e){!!this.static==!!c&&(this.prepareCanvas(this.getAbsoluteCenter(),a),this.preparePath(a),a.ctx.rect(-this.width/2*d.globalScale,-this.height/2*d.globalScale,this.width*d.globalScale,this.height*d.globalScale),this.finalizeCanvas(a),this.restoreCanvas(a));d.callSuperMethod(k.rectangle,this,"render",a,c,e)};k.arc=function(a,c,e,f,h,g){d.callSuperConstructor(k.arc,this);this.x=a;this.y=
c;this.radius=e;this.startAngle=f;this.endAngle=h;this.antiClockWise=g;this.width=2*e;this.height=2*e};d.extend(k.arc,k);k.arc.prototype.render=function(a,c,e){!!this.static==!!c&&(this.prepareCanvas(this.getAbsoluteCenter(),a),this.preparePath(a),a.ctx.arc(0,0,this.radius*d.globalScale,this.startAngle,this.endAngle,this.antiClockWise),this.finalizeCanvas(a),this.restoreCanvas(a));d.callSuperMethod(k.arc,this,"render",a,c,e)};k.polygon=function(a){if(!a||2>a.length)throw Error("Invalid parameters");
d.callSuperConstructor(k.polygon,this);this.points=a;for(var c=Number.MAX_VALUE,e=Number.MAX_VALUE,f=Number.MIN_VALUE,h=Number.MIN_VALUE,g=0;g<a.length;g++)a[g].x<c&&(c=a[g].x),a[g].y<e&&(e=a[g].y),a[g].x>f&&(f=a[g].x),a[g].y>h&&(h=a[g].y);this.width=f-c;this.height=h-e};d.extend(k.polygon,k);k.polygon.prototype.render=function(a,c,e){if(!!this.static==!!c){this.prepareCanvas(this.getAbsoluteCenter(),a);this.preparePath(a);a.ctx.moveTo(this.points[0].x*d.globalScale,this.points[0].y*d.globalScale);
for(var f=1;f<this.points.length;f++)a.ctx.lineTo(this.points[f].x*d.globalScale,this.points[f].y*d.globalScale);a.ctx.lineTo(this.points[0].x*d.globalScale,this.points[0].y*d.globalScale);this.finalizeCanvas(a);this.restoreCanvas(a)}d.callSuperMethod(k.polygon,this,"render",a,c,e)};k.text=function(a,c,e){d.callSuperConstructor(k.text,this);this.x=a;this.y=c;this.text=e;this.align=k.text.ALIGN_LEFT;this.valign=k.text.VALIGN_MIDDLE;this.style="normal";this.size=10;this.font="sans-serif"};d.extend(k.text,
k);k.text.ALIGN_LEFT="left";k.text.ALIGN_CENTER="center";k.text.ALIGN_RIGHT="right";k.text.VALIGN_TOP="top";k.text.VALIGN_MIDDLE="middle";k.text.VALIGN_BOTTOM="bottom";k.text.prototype.getRect=function(a){return a.ctx.measureText(this.text)};k.text.prototype.render=function(a,c,e){!!this.static==!!c&&(this.prepareCanvas(this.getAbsoluteCenter(),a),this.preparePath(a),a.ctx.font=this.style+" "+Math.floor(this.size*d.globalScale)+"px "+this.font,a.ctx.textAlign=this.align,a.ctx.textBaseline=this.valign,
this.fillColor&&a.ctx.fillText(this.text,0,0),a.ctx.strokeText(this.text,0,0),this.finalizeCanvas(a),this.restoreCanvas(a));d.callSuperMethod(k.text,this,"render",a,c,e)};k.free=function(){this.commands=[];d.callSuperConstructor(k.free,this)};d.extend(k.free,k);k.free.prototype.clear=function(){this.commands=[]};k.free.prototype.beginPath=function(){this.commands.push({command:"beginPath"});return this};k.free.prototype.stroke=function(){this.commands.push({command:"stroke"});return this};k.free.prototype.setStrokeStyle=
function(a){this.commands.push({command:"setStrokeStyle",style:a});return this};k.free.prototype.setFillStyle=function(a){this.commands.push({command:"setFillStyle",style:a});return this};k.free.prototype.fill=function(){this.commands.push({command:"fill"});return this};k.free.prototype.moveTo=function(a,c){this.commands.push({command:"moveTo",x:a,y:c});return this};k.free.prototype.lineTo=function(a,c){this.commands.push({command:"lineTo",x:a,y:c});return this};k.free.prototype.arc=function(a,c,
d,f,h,g){this.commands.push({command:"arc",x:a,y:c,radius:d,startAngle:f,endAngle:h,antiClockWise:g});return this};k.free.prototype.circle=function(a,c,d){this.commands.push({command:"circle",x:a,y:c,radius:d});return this};k.free.prototype.rect=function(a,c,d,f){this.commands.push({command:"circle",x:a,y:c,width:d,height:f});return this};k.free.prototype.polygon=function(a){this.commands.push({command:"polygon",points:a});return this};k.free.prototype.executeCommand=function(a,c){switch(c.command){case "beginPath":a.ctx.beginPath();
break;case "stroke":a.ctx.stroke();break;case "fill":a.ctx.fill();break;case "setStrokeStyle":a.ctx.strokeStyle=0<this.lineWidth?c.style:"transparent";break;case "setFillStyle":a.ctx.fillStyle=c.style;break;case "moveTo":a.ctx.moveTo(c.x*d.globalScale,c.y*d.globalScale);break;case "lineTo":a.ctx.lineTo(c.x*d.globalScale,c.y*d.globalScale);break;case "arc":a.ctx.arc(c.x*d.globalScale,c.y*d.globalScale,c.radius*d.globalScale,c.startAngle,c.endAngle,c.antiClockWise);break;case "circle":a.ctx.arc(c.x*
d.globalScale,c.y*d.globalScale,c.radius*d.globalScale,0,2*Math.PI);break;case "rect":a.ctx.rect((c.x-c.width/2)*d.globalScale,(c.y-c.height/2)*d.globalScale,c.width*d.globalScale,\u0441.height*d.globalScale);break;case "polygon":a.ctx.moveTo(c.points[0].x*d.globalScale,c.points[0].y*d.globalScale);for(var e=1;e<c.points.length;e++)a.ctx.lineTo(c.points[e].x*d.globalScale,c.points[e].y*d.globalScale);a.ctx.lineTo(c.points[0].x*d.globalScale,c.points[0].y*d.globalScale)}};k.free.prototype.executeCommands=
function(a){for(var c=0;c<this.commands.length;c++)this.executeCommand(a,this.commands[c])};k.free.prototype.render=function(a,c,e){!!this.static==!!c&&(this.prepareCanvas(this.getAbsoluteCenter(),a),this.preparePath(a),this.executeCommands(a),this.finalizeCanvas(a),this.restoreCanvas(a));d.callSuperMethod(k.free,this,"render",a,c,e)};(u||window).Graphics=k;d.extend(p,q);p.create=function(a,c){if("string"==typeof a){c=c||window.library;if(!c)throw Error("Could not create sprite from asset '%s'. Library not found.",
a);a=c.getAsset(a)}return new p(a.bitmap,a.width||1,a.height||1,a.frames||1,a.layers||1)};p.prototype.play=function(){this.animated=!0};p.prototype.stop=function(){this.animated=!1};p.prototype.gotoAndStop=function(a){this.currentFrame=a;this.stop()};p.prototype.gotoAndPlay=function(a){this.currentFrame=a;this.play()};p.prototype.nextFrame=function(a){this.dispatchEvent("enterframe",{target:this,delta:a});var c=1;if(p.CHANGE_FRAME_TYPE==p.CHANGE_FRAME_BY_TIME)if(this.changeFrameTime+=a,this.changeFrameTime>=
this.changeFrameDelay*this.animDelay)c=Math.floor(this.changeFrameTime/(this.changeFrameDelay*this.animDelay)),this.changeFrameTime-=Math.abs(c)*this.changeFrameDelay*this.animDelay;else return;else this.animStep++;if(this.animStep>=this.animDelay||p.CHANGE_FRAME_TYPE==p.CHANGE_FRAME_BY_TIME){for(var d=0;d<c;d++)this.animated&&(this.currentFrame+=this.animDirection),0<this.animDirection&&this.currentFrame>=this.totalFrames&&(this.currentFrame=0),0>this.animDirection&&0>this.currentFrame&&(this.currentFrame=
this.totalFrames-1),this.dispatchEvent("changeframe",{target:this,delta:a});this.animStep=0}};p.prototype.setMask=function(a){this.mask=a;this.mask.isMask=!0;this.mask.stage=this.stage;this.mask.maskParent=this};p.prototype.renderBack=function(a,c,d,f,h,g){c&&(a.ctx.fillStyle=c,a.ctx.strokeStyle=c,a.ctx.fillRect(d,f,h,g))};p.prototype.renderBitmap=function(a,c,e,f,h){var g={x:0,y:0,width:f,height:h};if(this.bitmap){var k=this.bitmap.width,l=this.bitmap.height,m=this.currentLayer*f+this.offset.left*
d.globalScale,n=this.currentFrame*h+this.offset.top*d.globalScale;if(m<k&&n<l){var v=f,r=h;m+v>k&&(v=k-m);n+r>l&&(r=l-n);p.FLOOR_VALUES_ON_RENDER&&(m=~~m,n=~~n,v=~~v,r=~~r,c=~~c,e=~~e,f=~~f,h=~~h);0<v&&0<r&&0<f&&0<h&&a.ctx.drawImage(this.bitmap,m,n,v,r,c,e,f,h);g.x=m;g.y=n;g.width=v;g.height=r}}return g};p.prototype.render=function(a,c,e,f){if(!this.isMask||f){if(!!this.static==!!c){e||(e=0);this.nextFrame(e);if(!1===this.dispatchEvent("prerender",{target:this,canvas:a,delta:e})||!this.stage)return;
var h=this.getAbsoluteCenter();if(f){var h={x:this.x-this.getAnchor().x,y:this.y-this.getAnchor().y},g=this.parent?this.parent:this.maskParent;g&&(h.x+=g.getAnchor().x+g.width/2,h.y+=g.getAnchor().y+g.height/2)}f=this.width*d.globalScale;var k=this.height*d.globalScale,l=h.x*d.globalScale-Math.floor(f/2),h=h.y*d.globalScale-Math.floor(k/2),m=this.getAbsoluteRotation(),g=this.getAbsoluteScaleX(),q=this.getAbsoluteScaleY(),v=this.getAbsoluteSkewX(),r=this.getAbsoluteSkewY(),s=this.getFillStyle(a),u=
Boolean(0!=m||1!=g||1!=q||this.shadowColor||s||0!=v||0!=r);this.ignoreViewport||(l-=this.stage.viewport.x*d.globalScale,h-=this.stage.viewport.y*d.globalScale);u&&(a.ctx.save(),a.ctx.translate(l+Math.floor(f/2),h+Math.floor(k/2)),a.ctx.rotate(m),a.ctx.scale(g,q),0==v&&0==r||a.ctx.transform(1,v,r,1,0,0),l=-Math.floor(f/2),h=-Math.floor(k/2),this.shadowColor&&(0!=m?(g=new n(this.shadowOffsetX*d.globalScale,this.shadowOffsetY*d.globalScale),g.rotate(-m),a.ctx.shadowOffsetX=g.x,a.ctx.shadowOffsetY=g.y):
(a.ctx.shadowOffsetX=this.shadowOffsetX*d.globalScale,a.ctx.shadowOffsetY=this.shadowOffsetY*d.globalScale),a.ctx.shadowColor=this.shadowColor,a.ctx.shadowBlur=this.shadowBlur*d.globalScale));a.ctx.globalAlpha=this.getAbsoluteOpacity();this.ceilSizes&&(f=Math.ceil(f),k=Math.ceil(k));this.mask?(this.stage.buffer.ctx.save(),this.stage.buffer.ctx.clearRect(0,0,f,k),this.renderBack(this.stage.buffer,s,0,0,f,k),m=this.renderBitmap(this.stage.buffer,0,0,f,k),this.stage.buffer.ctx.globalCompositeOperation=
this.maskInvert?"destination-out":"destination-in",this.mask.render?this.mask.render(this.stage.buffer,c,e,!0):this.stage.buffer.ctx.drawImage(this.mask,this.mask.x?this.mask.x:0,this.mask.y?this.mask.y:0),p.FLOOR_VALUES_ON_RENDER?a.ctx.drawImage(this.stage.buffer,0,0,m.width,m.height,~~l,~~h,~~f,~~k):a.ctx.drawImage(this.stage.buffer,0,0,m.width,m.height,l,h,f,k),this.stage.buffer.ctx.restore()):(this.renderBack(a,s,l,h,f,k),this.renderBitmap(a,l,h,f,k));u&&a.ctx.restore();this.stage.allowDebugDrawing&&
this.allowDebugDrawing&&(!this.stage.allowStaticDebugDrawing&&this.static||this.debugDraw());this.dispatchEvent("render",{target:this,canvas:a,delta:e})}d.callSuperMethod(p,this,"render",a,c,e)}};p.CHANGE_FRAME_BY_FRAME=0;p.CHANGE_FRAME_BY_TIME=1;p.CHANGE_FRAME_DELAY=1E3/24;p.CHANGE_FRAME_TYPE=p.CHANGE_FRAME_BY_FRAME;p.FLOOR_VALUES_ON_RENDER=!0;(u||window).Sprite=p;d.extend(w,z);w.prototype.update=function(a){if(!this.paused){w.TIMEOUT_TYPE==w.TIMEOUT_BY_FRAME?this.timeout--:this.timeout-=a;if(0>=
this.timeout)if("string"==typeof this.onend?eval(this.onend):this.dispatchEvent("end",{target:this}),this.repeat)this.timeout=this.initialTimeout;else return!0;this.dispatchEvent("tick",{target:this,delta:a});return!1}};w.prototype.resume=function(){this.paused=!1};w.prototype.pause=function(){this.paused=!0};w.TIMEOUT_BY_FRAME=0;w.TIMEOUT_BY_TIME=1;w.TIMEOUT_TYPE=w.TIMEOUT_BY_FRAME;(u||window).StageTimer=w;d.extend(m,l);m.prototype.refreshBackground=function(){this.needToRebuildBack=!0};m.prototype.setBackgroundCanvas=
function(a){a&&(this.backgroundCanvas=document.getElementById(a),this.backgroundCanvas.ctx=this.backgroundCanvas.getContext("2d"))};m.prototype.destroy=function(){clearTimeout(this.tmMain);clearTimeout(this.tmFPS);this.stop();this.clear();this.clearScreen(this.canvas);this.backgroundCanvas&&this.clearScreen(this.backgroundCanvas);this.removeInputListeners(this.stage)};m.prototype.clearScreen=function(a){this.clearLock||a.ctx.clearRect(0,0,Math.floor(a.width),Math.floor(a.height))};m.prototype.addChild=
function(a){a.stage=this;return d.callSuperMethod(m,this,"addChild",a)};m.prototype.setZIndex=function(a,c){this.setChildZIndex(a,c)};m.prototype.removeChild=function(a){a&&0<=this.objects.indexOf(a)&&(this.clearObjectTweens(a),a.stage=null,d.callSuperMethod(m,this,"removeChild",a))};m.prototype.finalizeMouseCoords=function(a,c){if(!a)return c;var d=this.prepareMouseCoord(c.x),f=this.prepareMouseCoord(c.y);a.ignoreViewport||(d+=this.viewport.x,f+=this.viewport.y);d-=a.x;f-=a.y;return{x:d,y:f}};m.prototype.prepareMouseCoord=
function(a){return a/d.globalScale/d.globalPixelScale};m.prototype.processMouseEvent=function(a,c,e){a=d.getMouseCoord(a,this.inputController);e=this.getObjectsStackByCoord(this.prepareMouseCoord(a.x),this.prepareMouseCoord(a.y),e,!1);for(var f,h=0;h<e.length;h++)if(f=this.finalizeMouseCoords(e[h],a),f=e[h].dispatchEvent(c,{target:e[h],x:f.x,y:f.y}),!1===f)return;this.dispatchEvent(c,{target:this,x:Math.floor(this.prepareMouseCoord(a.x)),y:Math.floor(this.prepareMouseCoord(a.y))})};m.prototype.checkClick=
function(a){this.processMouseEvent(a,"click",this.pixelClickEvent)};m.prototype.checkContextMenu=function(a){this.processMouseEvent(a,"contextmenu",this.pixelClickEvent)};m.prototype.checkMouseMove=function(a){a=d.getMouseCoord(a,this.inputController);this.doDrag(this.prepareMouseCoord(a.x),this.prepareMouseCoord(a.y));var c=this.getObjectsStackByCoord(this.prepareMouseCoord(a.x),this.prepareMouseCoord(a.y),this.pixelMouseMoveEvent),e,f,h,g=[];if(0<c.length){for(e=0;e<c.length&&(g.push(c[e]),h=this.finalizeMouseCoords(c[e],
a),c[e].mouseOn||(f=c[e].dispatchEvent("mouseover",{target:c[e],x:h.x,y:h.y})),c[e].mouseOn=!0,!1!==f);e++);f=!0;for(e=0;e<c.length&&(h=this.finalizeMouseCoords(c[e],a),f=c[e].dispatchEvent("mousemove",{target:c[e],x:h.x,y:h.y}),!1!==f);e++);!1!==f&&this.dispatchEvent("mousemove",{target:this,x:Math.floor(this.prepareMouseCoord(a.x)),y:Math.floor(this.prepareMouseCoord(a.y))})}this.checkMouseOut(g,a)};m.prototype.checkMouseDown=function(a){this.processMouseEvent(a,"mousedown",this.pixelMouseDownEvent)};
m.prototype.checkMouseUp=function(a){this.processMouseEvent(a,"mouseup",this.pixelMouseUpEvent)};m.prototype.clear=function(){this.tweens=[];this.timers=[];this.eventsListeners=[];this.objectsCounter=0;d.callSuperMethod(m,this,"clear")};m.prototype.hitTest=function(a,c){if(0==a.getAbsoluteRotation()&&0==c.getAbsoluteRotation()){var d=a.getX()-a.getWidth()/2,f=a.getY()-a.getHeight()/2,h=c.getX()-c.getWidth()/2,g=c.getY()-c.getHeight()/2,k=Math.max(f,g),l=Math.max(d,h),d=Math.min(d+a.getWidth(),h+c.getWidth()),
f=Math.min(f+a.getHeight(),g+c.getHeight())-k;return 0<d-l&&0<f?!0:!1}l=a.getDrawRectangle();f=c.getDrawRectangle();return l.hitTestRectangle(f)};m.prototype.getCenter=function(){return{x:this.screenWidth/2,y:this.screenHeight/2}};m.prototype.drawRectangle=function(a,c,e,f,h,g,k,l){var m=this.canvas;m.ctx.globalAlpha="undefined"!=typeof k?k:1;m.ctx.fillStyle=h;m.ctx.strokeStyle=h;l||(a-=this.viewport.x,c-=this.viewport.y);a*=d.globalScale;c*=d.globalScale;e*=d.globalScale;f*=d.globalScale;g?m.ctx.fillRect(a-
e/2,c-f/2,e,f):m.ctx.strokeRect(a-e/2,c-f/2,e,f)};m.prototype.drawCircle=function(a,c,d,f,h,g,k){this.drawArc(a,c,d,0,2*Math.PI,!1,f,h,g,k)};m.prototype.drawArc=function(a,c,e,f,h,g,k,l,m,p){var n=this.canvas,q=n.ctx.lineWidth;"undefined"==typeof l&&(l="#000");n.ctx.strokeStyle=l;"undefined"==typeof k&&(k=1);n.ctx.lineWidth=k*d.globalScale;"undefined"==typeof m&&(m=1);n.ctx.globalAlpha=m;p||(a-=this.viewport.x,c-=this.viewport.y);a*=d.globalScale;c*=d.globalScale;e*=d.globalScale;n.ctx.beginPath();
n.ctx.arc(a,c,e,f,h,g);n.ctx.stroke();n.ctx.lineWidth=q};m.prototype.drawPolygon=function(a,c,d,f,h){if("object"==typeof a&&a instanceof Array&&!(2>a.length)){for(var g=0;g<a.length-1;g++)this.drawLine(a[g].x,a[g].y,a[g+1].x,a[g+1].y,c,d,f,h);this.drawLine(a[g].x,a[g].y,a[0].x,a[0].y,c,d,f,h)}};m.prototype.drawLine=function(a,c,e,f,h,g,k,l){var m=this.canvas,n=m.ctx.lineWidth;m.ctx.strokeStyle=g?g:"#000";m.ctx.lineWidth=h?h*d.globalScale:1*d.globalScale;m.ctx.globalAlpha=k?k:1;l||(a-=this.viewport.x,
c-=this.viewport.y,e-=this.viewport.x,f-=this.viewport.y);a*=d.globalScale;c*=d.globalScale;e*=d.globalScale;f*=d.globalScale;m.ctx.beginPath();m.ctx.moveTo(a,c);m.ctx.lineTo(e,f);m.ctx.stroke();m.ctx.lineWidth=n};m.prototype.start=function(){this.started||(this.started=!0,this.clearFPS(),this.tick())};m.prototype.forceRender=function(){this.started&&this.tick()};m.prototype.stop=function(){this.started=!1};m.prototype.clearFPS=function(){this.lastFPS=this.fps;this.fps=0;this.started&&(this.tmFPS=
setTimeout(this.clearFPS,1E3))};m.prototype.setTextStyle=function(a,c,e,f,h,g){g=g?g:this.canvas;g.ctx.fillStyle=f;g.ctx.strokeStyle=h;f="";e&&(f+=e+" ");c&&(f+=Math.floor(c*d.globalScale)+"px ");a&&(f+=a);g.ctx.font=f};m.prototype.drawText=function(a,c,e,f,h,g,k){k=k?k:this.canvas;k.ctx.globalAlpha="undefined"==typeof f?1:f;h||(c-=this.viewport.x,e-=this.viewport.y);c*=d.globalScale;e*=d.globalScale;g&&(c-=this.getTextWidth(a)/2);k.ctx.fillText(a,c,e)};m.prototype.strokeText=function(a,c,e,f,h,g,
k){k=k?k:this.canvas;k.ctx.globalAlpha="undefined"==typeof f?1:f;h||(c-=this.viewport.x,e-=this.viewport.y);c*=d.globalScale;e*=d.globalScale;g&&(c-=this.getTextWidth(a)/2);k.ctx.strokeText(a,c,e)};m.prototype.getTextWidth=function(a,c){return(c?c:this.canvas).ctx.measureText(a).width};m.prototype.render=function(a,c,e,f){a&&(f||(f=0),a&&!a.ctx&&(a.ctx=a.getContext("2d")),e||((e=this.getFillStyle(a))?(a.ctx.fillStyle=e,a.ctx.fillRect(0,0,a.width,a.height)):this.clearLock||this.clearScreen(a)),d.callSuperMethod(m,
this,"render",a,c,f))};m.prototype.createTween=function(a,c,d,f,h,g){a=new s(a,c,d,f,h,g);this.tweens.push(a);return a};m.prototype.removeTween=function(a){var c=null;if(isNaN(a))for(var d=0;d<this.tweens.length;d++){if(this.tweens[d]===a){c=d;break}}else c=a;isNaN(c)||(this.tweens[c]&&this.tweens[c].pause(),this.tweens.splice(c,1));return c};m.prototype.clearObjectTweens=function(a){for(var c=0;c<this.tweens.length;c++)this.tweens[c].obj===a&&(this.tweens[c].destroy=!0)};m.prototype.updateTweens=
function(a){for(var c=0;c<this.tweens.length;c++)this.tweens[c].destroy&&(c=this.removeTween(c),c--);for(c=0;c<this.tweens.length;c++)this.tweens[c].tick(a)&&this.tweens[c]&&(this.tweens[c].destroy=!0)};m.prototype.setTimeout=function(a,c){var d=new w(a,c);this.timers.push(d);return d};m.prototype.clearTimeout=function(a){this.timers=d.removeFromArray(this.timers,a)};m.prototype.setInterval=function(a,c){var d=new w(a,c,!0);this.timers.push(d);return d};m.prototype.clearInterval=function(a){this.clearTimeout(a)};
m.prototype.updateTimers=function(a){for(var c=0;c<this.timers.length;c++)this.timers[c].update(a)&&(this.clearTimeout(this.timers[c]),c--)};m.prototype.tick=function(){clearTimeout(this.tmMain);var a;if(d.isWindowHidden)this.lastTick=0,a=this.delay;else{a=(new Date).getTime();var c=this.lastTick?a-this.lastTick:this.delay;this.lastTick=a;this.dispatchEvent("pretick",{target:this,delta:c});if(!this.started){this.lastTick=0;return}this.updateTweens(c);if(!this.started){this.lastTick=0;return}this.updateTimers(c);
if(!this.started){this.lastTick=0;return}var e=!1;this.drawBackAlways?(this.render(this.canvas,!0,!1,c),e=!0):this.needToRebuildBack&&(this.needToRebuildBack=!1,this.backgroundCanvas&&this.render(this.backgroundCanvas,!0));this.render(this.canvas,!1,e,c);this.showFPS&&(this.setTextStyle("sans-serif",10,"bold","#fff","#000"),this.drawText("FPS: "+this.lastFPS,2,10,1,!0));this.dispatchEvent("posttick",{target:this,delta:c});a=(new Date).getTime()-a;a=this.delay-a;1>a&&(a=1);this.fps++}this.started?
this.tmMain=setTimeout(this.tick,a):this.lastTick=0};m.prototype.box2dSync=function(a){for(b=a.m_bodyList;b;b=b.m_next)b.sprite&&(b.sprite.rotation=b.GetRotation(),a=b.GetPosition(),b.sprite.x=a.x,b.sprite.y=a.y,b.sprite.dispatchEvent("box2dsync",{target:b.sprite}))};m.prototype.processTouchEvent=function(a,c){for(var d=0;d<a.length;d++)this[c]({clientX:a[d].clientX,clientY:a[d].clientY})};m.prototype.addInputListeners=function(a){this.inputController=a;d.touchScreen?(a.ontouchstart=d.proxy(function(a){this.processTouchEvent(a.touches,
"checkMouseDown");this.processTouchEvent(a.touches,"checkClick");a.preventDefault()},this),a.ontouchmove=d.proxy(function(a){this.processTouchEvent(a.touches,"checkMouseMove");a.preventDefault()},this),a.ontouchend=d.proxy(function(a){this.processTouchEvent(a.changedTouches,"checkMouseUp");a.preventDefault()},this)):(a.onclick=d.proxy(function(a){this.checkClick(a)},this),a.onmousemove=d.proxy(function(a){this.checkMouseMove(a)},this),a.onmousedown=d.proxy(function(a){0==a.button&&this.checkMouseDown(a)},
this),a.onmouseup=d.proxy(function(a){0==a.button&&this.checkMouseUp(a)},this),a.oncontextmenu=d.proxy(function(a){this.checkContextMenu(a)},this))};m.prototype.removeInputListeners=function(a){a.ontouchstart=null;a.ontouchmove=null;a.ontouchend=null;a.onclick=null;a.onmousemove=null;a.onmousedown=null;a.onmouseup=null;a.oncontextmenu=null};(u||window).Stage=m})(window);